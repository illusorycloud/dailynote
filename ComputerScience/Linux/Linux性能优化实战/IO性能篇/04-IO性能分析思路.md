# Linux I/O性能分析思路

## 1. 性能指标

### 文件系统 I/O 性能指标

* **存储空间使用情况**：包括容量、使用量以及剩余空间等。
* **索引节点使用情况**：它也包括容量、使用量以及剩余量等三个指标
* **缓存使用情况**：包括页缓存、目录项缓存、索引节点缓存以及各个具体文件系统（如 ext4、XFS 等）的缓存。



### 磁盘 I/O 性能指标

主要关注以下四个核心的磁盘 I/O 指标：

* **使用率**：磁盘忙处理 I/O 请求的百分比。过高的使用率（比如超过 60%）通常意味着磁盘 I/O 存在性能瓶颈。
* **IOPS**（Input/Output Per Second）：是指每秒的 I/O 请求数
* **吞吐量**：每秒的 I/O 请求大小。
* **响应时间**：从发出 I/O 请求到收到响应的间隔时间。



## 2. 性能工具

### 根据指标找工具

| 指标                                                         | 工具                          | 说明                                       |
| ------------------------------------------------------------ | ----------------------------- | ------------------------------------------ |
| 文件系统空间容量、使用量以及剩余空间                         | df                            | 详细文档见 info coreutils 'df invocat ion' |
| 索引节点容量、使用量以及剩余量                               | df                            | 使用 -i 选项                               |
| 页缓存和可回收Slab缓存                                       | /proc/meminfo<br/>sar、vmstat | 使用sar -r选项                             |
| 缓冲区                                                       | /proc/meminfo<br/>sar、vmstat | 使用sar -r选项                             |
| 目录项、索引节点以及文件系统的缓存                           | /proc/slabinfo<br/>slabtop    | slabtop更直观                              |
| 磁盘/O使用率、lOPS、吞吐量、响应时间、/O平均大小以及等待队列长度 | lostat<br/>sar、dstat         | 使用iostat -d-x或sar -d选项                |
| 进程V/O大小以及I/O延迟                                       | pidstat<br/>iotop             | 使用pidstat -d选项                         |
| 块设备I/O事件跟踪                                            | blktrace                      |                                            |
| 进程I/O系统调用跟踪                                          | strace                        | 通过系统调用跟踪进程的I/O                  |
| 进程块设备I/O大小跟踪                                        | biosnoop<br/>biotop           | 需要安装bcc软件包                          |



### 根据工具查指标

| 性能工具 | 性能指标 |
| -------- | -------- |
| iostat   |          |
| pidstat  |          |
| sar      |          |
| dstat    |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |
|          |          |



## 3. 分析思路

* 1）先用 iostat 发现磁盘 I/O 性能瓶颈；
* 2）再借助 pidstat ，定位出导致瓶颈的进程；
* 3）随后分析进程的 I/O 行为；
* 4）最后，结合应用程序的原理，分析这些 I/O 的来源。

为了缩小排查范围，建议先运行那几个支持指标较多的工具，如 iostat、vmstat、pidstat 等。