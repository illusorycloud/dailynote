# Linux 系统网络性能评估

## 1. 概述

最基本的网络性能指标：

* 1）**带宽**，表示链路的最大传输速率，单位是 b/s（比特 / 秒
* 2）**吞吐量**，表示没有丢包时的最大数据传输速率，单位通常为 b/s （比特 / 秒）或者 B/s（字节 / 秒）
* 3）**延时**，表示从网络请求发出后，一直到收到远端响应，所需要的时间延迟。
* 4）**PPS**，是 Packet Per Second（包 / 秒）的缩写，表示以网络包为单位的传输速率。



## 2. 网络基准测试

根据应用程序确定需要测试网络协议栈的哪一层：

* 基于 HTTP 或者 HTTPS 的 Web 应用程序，显然属于应用层，需要我们测试 HTTP/HTTPS 的性能；
* 而对大多数游戏服务器来说，为了支持更大的同时在线人数，通常会基于 TCP 或 UDP ，与客户端进行交互，这时就需要我们测试 TCP/UDP 的性能；
* 当然，还有一些场景，是把 Linux 作为一个软交换机或者路由器来用的。这种情况下，你更关注网络包的处理能力（即 PPS），重点关注网络层的转发性能。



### 2.1 转发性能

网络接口层和网络层，它们主要负责网络包的封装、寻址、路由以及发送和接收。

推荐使用 hping3、pktgen  来测试网络包处理能力。



### 2.2 TCP/UDP 性能

 TCP 和 UDP 的性能测试方法比较多，iperf 和 netperf 都是最常用的网络性能测试工具，用于测试 TCP 和 UDP 的吞吐量。

> 接下来以 iperf 为例

安装

```sh
# Ubuntu
apt-get install iperf3
# CentOS
yum install iperf3
```

然后，在目标机器上启动 iperf 服务端：

```sh
# -s表示启动服务端，-i表示汇报间隔，-p表示监听端口
$ iperf3 -s -i 1 -p 50051
```

接着，在另一台机器上运行 iperf 客户端，运行测试：

```sh
# -c表示启动客户端，192.168.0.30为目标服务器的IP
# -b表示目标带宽(单位是bits/s)
# -t表示测试时间
# -P表示并发数，-p表示目标服务器监听端口
$ iperf3 -c 192.168.0.30 -b 1G -t 15 -P 2 -p 50051
```

稍等一会儿（15 秒）测试结束后，回到目标服务器，查看 iperf 的报告：

```sh

[ ID] Interval           Transfer     Bandwidth
...
[SUM]   0.00-15.04  sec  0.00 Bytes  0.00 bits/sec                  sender
[SUM]   0.00-15.04  sec  1.51 GBytes   860 Mbits/sec                  receiver
```

最后的 SUM 行就是测试的汇总结果，包括测试时间、数据传输量以及带宽等。按照发送和接收，这一部分又分为了 sender 和 receiver 两行。



### 2.3 HTTP 性能

要测试 HTTP 的性能，也有大量的工具可以使用，比如 ab、webbench、wrk等，都是常用的 HTTP 压力测试工具。其中，ab 是 Apache 自带的 HTTP 压测工具，主要测试 HTTP 服务的每秒请求数、请求延迟、吞吐量以及请求延迟的分布情况等。