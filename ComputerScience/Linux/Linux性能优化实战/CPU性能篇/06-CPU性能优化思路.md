# CPU性能优化思路

## 1. 概述

### 1.性能优化的效果判断

**1.性能优化的效果判断**

* 1）确定性能的量化指标：不要局限在单一维度的指标上
  * 应用程序维度：吞吐量和请求延迟
  * 系统资源维度：CPU 使用率
* 2）测试优化前的性能指标
* 3）测试性能优化后的性能指标

**2.当性能问题有多个时，优先级问题**
  先优化最重要的且最大程度提升性能的问题开始优化

**3.优化方法有多个时，该如何选**

  综合多方面因素



## 2. 具体措施

### 1. 应用相关



排除不必要工作，只留核心逻辑。

* 1）减少循环次数 减少递归 减少动态没错分配
* 2）编译器优化
* 3）算法优化
  * 使用复杂度更低的算法，可以显著加快处理速度。
* 4）异步处理
  * 使用异步处理，可以避免程序因为等待某个资源而一直阻塞，从而提升程序的并发处理能力。
* 5）多线程代替多进程
* 6）缓存



### 2. 系统相关

利用CPU缓存本地性，加速缓存访问;控制进程的cpu使用情况，减少程序的处理速度。

* 1）CPU绑定
  * 把进程绑定到一个或者多个 CPU 上，可以提高 CPU 缓存的命中率，减少跨 CPU 调度带来的上下文切换问题。
* 2）CPU独占
  * 跟 CPU 绑定类似，进一步将 CPU 分组，并通过 CPU 亲和性机制为其分配进程。
* 3）进程优先级调整
  * 使用 nice 调整进程的优先级，正值调低优先级，负值调高优先级
* 4）为进程设置资源限制
  * 使用 Linux cgroups  来设置进程的 CPU 使用上限
* 5）NUMA优化
* 6）中断负载均衡
  * 开启 irqbalance 服务或者配置 smp_affinity，把中断处理过程自动负载均衡到多个 CPU 上。



## 3. 小结

性能是由多方面共同决定的，可能是CPU、内存、网络、I/O 甚至是架构设计的问题。所以并不是把某一方面优化到极致就能解决问题。

> 要找到最有性价比的优化方案。

发现性能问题后，不要急于动手优化，而要先找出最重要的、可以获得最大性能提升的问题，然后再从应用程序和系统两个方面入手优化。

**注意：千万避免过早优化。**