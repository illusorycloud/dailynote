# 计算机网络之端口和套接字

**两台计算机间进行通讯需要以下三个条件：**

​            **``IP地址``、`连接使用的协议`、``端口号``**

端口和套接字，用于确定指定主机上的哪个本地进程使用了哪个协议和哪台远程主机上的哪个进程进行了通信。端口和套接字的使用可以基于以下几点：

①为每个应用过程分配一个过程标识符（Process ID），每次启动一个进程时，这个ID都可能是不同的。

②进程ID因操作系统平台不同而不同，因而它们是不统一的。

③一个服务器过程能够同时与多个客户连接，因而简单的连接标识符不可能是唯一的。

端口和套接字概念提供了一种以统一的方式唯一地标识连接以及参与连接的程序和主机的方法，而不管特定的过程ID。

## 端口

任何时候，多个进程可能同时使用TCP、UDP和SCTP这3种传输层协议中的任何一种。这3种协议都使用16位整数的端口号来区分这些进程。

当一个客户想要跟一个服务器联系时，它必须标识想要与之通信的这个服务器。TCP、UDP和SCTP定义了一组众所周知的端口号，用于标识众所周知的服务。

另一方面，客户通常使用短期存活的临时端口。这些端口号通常由传输层协议自动赋予客户，客户通常不关心其临时端口的具体值，而只需确信该端口在所在主机中是唯一的就行。传输协议的代码确保这种唯一性。

### 端口号的分配

端口号的分配是一个重要问题。有两种基本分配方式：第一种叫全局分配，这是一种集中控制方式，由一个公认的中央机构根据用户需要进行统一分配，并将结果公布于众。第二种是本地分配，又称动态连接，即进程需要访问传输层服务时，向本地操作系统提出申请，操作系统返回一个本地唯一的端口号，进程再通过合适的系统调用将自己与该端口号联系起来（绑扎）。TCP/IP端口号的分配中综合了上述两种方式。

知名端口即众所周知的端口号，范围从0到1023，这些端口号一般固定分配给一些服务。比如20/21端口分配给FTP(文件传输协议）服务，23端口分配给Telnet（远程登录），25端口分配给SMTP（简单邮件传输协议）服务，80端口分配给HTTP服务，135端口分配给RPC（远程过程调用）服务等等。

网络服务是可以使用其他端口号的，如果不是默认的端口号则应该在地址栏上指定端口号，方法是在地址后面加上冒号“:”（半角），再加上端口 号。比如使用“8080”作为WWW服务的端口，则需要在地址栏里输入“：8080”。

但是有些系统协议使用固定的端口号，它是不能被改变的，比如139 端口专门用于NetBIOS与TCP/IP之间的通信，不能手动改变。

### 端口被划分为以下3段

1）众所周知的端口为0~1023.这些端口由IANA分配和控制。可能的话，相同端口号就分配给TCP、UDP和SCTP的同一给定服务。例如，不论TCP还是UDP端口号80都被赋予Web服务器，尽管它目前的所有实现都单纯使用TCP。

2）已登记的端口为1024~49151.这些端口不受IANA控制，不过由IANA登记并提供它们的使用情况清单，以方便整个群众。可能的话，相同端口号也分配给TCP和UDP的同一给定服务。

3）49152~65535是动态的或私用的端口。IANA不管这些端口。它们就是我们所称的临时端口。



## 套接字

**源IP地址 + 目的IP地址 + 源端口号 + 目的端口号的组合称为套接字。 **

​	它是网络通信过程中端点的抽象表示，包含进行网络通信必需的五种信息：`连接使用的协议`，`本地主机的IP地址`，`本地进程的协议端口`，`远程主机的IP地址`，`远程进程的协议端口`。
	或者说，套接字，是支持TCP/IP的网络通信的基本操作单元，可以看做是不同主机之间的进程进行双向通信的端点，简单的说就是通信的两方的一种约定，用套接字中的相关函数来完成通信过程。

```java
非常非常简单的举例说明下:Socket=IP address+ TCP/UDP + port。
```

​	区分不同应用程序进程间的网络通信和连接,主要有3个参数：`通信的目的IP地址`、`使用的传输层协议(TCP或UDP)`和`使用的端口号`。Socket原意是 “插座”。通过将这3个参数结合起来，与一个“插座”Socket绑定，应用层就可以和传输层通过套接字接口，区分来自不同应用程序进程或网络连接的通信，实现数据传输的并发服务。

​	Socket可以看成在两个程序进行通讯连接中的一个端点，是连接应用程序和网络驱动程序的桥梁，Socket在应用程序中创建，通过绑定与网络驱动建立关系。此后，应用程序送给Socket的数据，由Socket交给网络驱动程序向网络上发送出去。计算机从网络上收到与该Socket绑定IP地址和端口号相关的数据后，由网络驱动程序交给Socket，应用程序便可从该Socket中提取接收到的数据，网络应用程序就是这样通过Socket进行数据的发送与接收的。

### 分类：

常用的TCP/IP协议的3种套接字类型如下所示。

#### 流套接字（SOCK_STREAM）：

流套接字用于提供面向连接、可靠的数据传输服务。该服务将保证数据能够实现无差错、无重复发送，并按顺序接收（数据在传送过程中顺序可能会发生变化，但是接收端最后是按顺序接收的）。流套接字之所以能够实现可靠的数据服务，原因在于其使用了传输控制协议，即TCP（The Transmission Control Protocol）协议。

#### 数据报套接字（SOCK_DGRAM）：

数据报套接字提供了一种无连接的服务。该服务并不能保证数据传输的可靠性，数据有可能在传输过程中丢失或出现数据重复，且无法保证顺序地接收到数据。数据报套接字使用UDP（User Datagram Protocol）协议进行数据的传输。由于数据报套接字不能保证数据传输的可靠性，对于有可能出现的数据丢失情况，需要在程序中做相应的处理。

#### 原始套接字（SOCK_RAW）：

原始套接字与标准套接字（标准套接字指的是前面介绍的流套接字和数据报套接字）的区别在于：原始套接字可以读写内核没有处理的IP数据包，而流套接字只能读取TCP协议的数据，数据报套接字只能读取UDP协议的数据。因此，如果要访问其他协议发送数据必须使用原始套接字。

### 通信：

使用套接字进行数据处理有两种基本模式：同步和异步。

#### 同步模式：

同步模式的特点是在通过Socket进行连接、接收、发送数据时，客户机和服务器在接收到对方响应前会处于阻塞状态，即一直等到收到对方请求进才继续执行下面的语句。可见，同步模式只适用于数据处理不太多的场合。当程序执行的任务很多时，长时间的等待可能会让用户无法忍受。

#### 异步模式：

异步模式的特点是在通过Socket进行连接、接收、发送操作时，客户机或服务器不会处于阻塞方式，而是利用callback机制进行连接、接收、发送处理，这样就可以在调用发送或接收的方法后直接返回，并继续执行下面的程序。可见，异步套接字特别适用于进行大量数据处理的场合。

使用同步套接字进行编程比较简单，而异步套接字编程则比较复杂。



# 参考

https://blog.csdn.net/u011068702/article/details/56479927

https://www.cnblogs.com/wuchanming/p/4018779.html

https://blog.csdn.net/fayery/article/details/38516447



