# MySQL体系结构和存储引擎



## 1. 定义数据库和实例

在数据库领域中有两个词很容易混淆，就是`数据库(database)`和`实例(instance)`。

**数据库**：物理操作系统文件或其他形式文件类型的集合。在MySQL数据库中，数据库文件可以是frm、MYD、MYI、ibd结尾的文件(NDB引擎除外)。

**实例**：MySQL数据库由后台线程以及一个共享内存区组成。共享内存可以被运行的后台线程所共享。需要牢记的是数据库实例才是真正用于操作数据库文件的。



**MySQL是一个单进程多线程架构的数据库。MYSQL数据库实例在系统上的表现是一个进程。**



配置文件读取顺序

```mysql
/etc/my.cnf /etc/mysql/my.cnf /usr/local/mysql/my.cnf ~/my.cnf
```

以最后读取到的配置文件为准。



## 2. MySQL体系结构

从概念上来说**数据库是文件的集合**，是依照某种数据模型组织起来并存放于二级存储器中的数据集合；**数据库实例是程序**，是位于用户与操作系统之间的一层数据管理软件。

MySQL体系结构：连接池组件、管理服务和工具组件、SQL接口组件、查询分析器组件、优化器组件、缓冲组件、插件式存储引擎、物理文件。




其中**存储引擎是基于表的，而不是数据库**。

## 3. MySQL存储引擎

### 1.InnoDB存储引擎

InnoDB存储引擎支持事务、行级锁、外键、非锁定读，是MySQL5.5.8之后的默认存储引擎。

通过多版本并发控制(MVCC)获取高并发性,并实现了SQL的4中隔离级别（默认repeatable）。同时使用next-key locking策略避免幻读产生。

另外还提供了插入缓冲、二次写、自适应哈希索引、预读等功能。

采用聚集方式存储数据，因此每张表的存储都是按主键的顺序进行存放。



### 2.MyISAM存储引擎

MyISAM不支持事务、支持表级锁、支持全文索引、面向OLAP数据库应用。

MyISAM存储引擎的缓冲池中只缓存储索引文件，而不缓冲数据文件。

MyISAM存储引擎表由MYD和MYI组成。MYD存放数据文件，MYI存放索引文件。

### 3 其他储存引擎

NDB(集群存储引擎)、Memory（默认使用哈希索引）、Archive、Federated、Maria等。

## 4. 存储引擎对比

| 功能         | MylSAM | MEMORY | InnoDB | Archive |
| ------------ | ------ | ------ | ------ | ------- |
| 存储限制     | 256TB  | RAM    | 64TB   | None    |
| 支持事务     | No     | No     | Yes    | No      |
| 支持全文索引 | Yes    | No     | No     | No      |
| 支持树索引   | Yes    | Yes    | Yes    | No      |
| 支持哈希索引 | No     | Yes    | No     | No      |
| 支持数据缓存 | No     | N/A    | Yes    | No      |
| 支持外键     | No     | No     | Yes    | No      |



## 5. 连接MySQL

连接MySQL操作时一个连接进程和MySQL数据库实例进行通信，本质上是进程通信。

进程通信方式：管道、命名管道、命名字、TCP/IP套接字、UNIX域套接字。


