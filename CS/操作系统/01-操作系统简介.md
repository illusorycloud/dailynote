# 操作系统简介

## 1. 操作系统做了什么

### 1.1 执行`helloworld`程序

```c
#include<studio.h>
int main(int argc,char *argv[])
{
    puts("hello world");
    return 0;
}
```

执行步骤

* 1.**用户**:告诉操作系统执行`helloworld`程序(命令行、双击可执行文件等)
* 2.**操作系统**：根据文件名在磁盘上查找`helloworld`程序的相关信息，检查是否为`可执行文件`(windows:`PE`,Linux:`ELF`)。并通过程序首部信息确定`代码``和数据`在可执行文件中的位置并计算出对应的`磁盘块地址`。
* 3.**操作系统**：创建一个新的`进程`，并将`Helloworld`程序可执行文件映射到该进程结构，表示由该进程执行`helloworld`程序
* 4.**操作系统**:为`helloworld`程序设置CPU`上下文环境`，并调到程序开始处。
* 5.执行`helloworld`程序的第一条指令，发生**缺页异常**(程序执行前需要先把代码和数据读入内存,cpu才能执行,这时候`helloworld`程序还未读入内存)。
* 6.**操作系统**:分配一页物理内存，并将代码从磁盘读入内存，然后继续执行`helloworld`程序
* 7.**helloworld程序**:执行**puts**函数(系统调用)，在显示器上写一字符串
* 8.**操作系统**：找到要显示的显示设备，通常设备是由一进程控制的，所以操作系统将要写的字符串送给该进程。
* 9.**操作系统**：控制设备的进程告诉设备的窗口系统它要显示字符串，窗口系统确定这是一个合法的操作，然后将字符串转换成像素，将像素写入设备的存储映像区。
* 10.**视频硬件**：将像素转换成显示器可以接收的一组控制/数据信号
* 11.**显示器**：解释信号，激发液晶屏
* 12.**结果**：在屏幕上看到了`hello world`

**小结**

程序执行中，操作系统负责了程序的启动过程，执行过程，同时在执行过程中不断的为用户程序执行提供各种支持。

### 1.2 操作系统定义

操作系统是计算机系统中的一个系统软件，是一些程序模块的集合。

* 他们能以尽量**有效、合理**的方式组织和管理计算机的软硬件资源
* 合理地组织计算机的工作流程，控制程序的执行并向用户提供各种服务功能。
* 使得用户能够灵活、**方便**地使用计算机，使整个计算机系统高效率运行。

**OS是资源的管理者**。

资源分配策略--算法

* 静态分配策略
* 动态分配策略(大多数操作系统)

资源管理角度--OS的五大基本功能

* 进程/线程管理(CPU)管理
  * 进程线程状态、控制同步互斥、通信、调度...
* 存储管理
  * 空间分配/回收、地址转换、存储保护、内存扩充...
* 文件管理
  * 文件目录、文件操作、磁盘空间、文件存取控制
* 设备管理
  * 设备驱动、分配回收、缓冲技术
* 用户接口
  * 系统命令、编程接口

### 1.3 操作系统特征

* **并发**：指处理多个同时性活动的能力
  * 宏观上(单CPU)：程序同时执行
  * 微观上(单CPU)：任何时刻都只有一个程序在执行，即程序在CPU上轮流执行
* **共享**：操作系统与多个用户程序共同使用计算机系统中的资源
  * 互斥共享：如打印机
  * 同时共享：如可重入代码，磁盘文件
* **虚拟**：一个物理实体映射为若干个对应的逻辑实体---分时或分空间(虚拟可提高资源利用率)
  * CPU：每个进程的`虚处理机`
  * 存储器：每个进程都有独立的虚拟地址空间(代码+数据+堆栈)
  * 显示设备：多窗口或虚拟终端
* **随机**：操作系统必须随时对付**以不可预测的次序**发生的事件进行响应并处理。
  * 进程的运行速度无法预知
  * 难以重现系统在某个时刻的状态

### 1.4 操作系统典型架构

#### windows

```go
系统进程、服务进程、用户进程、环境子系统(win32)
动态链接库(DLL)
//                 用户态
//-----------------------------
//                 内核态
系统服务分发器
内核态可调用接口
执行体
内核、设备驱动程序、图形与窗口
硬件抽象层(HAL)
//------------------------
//                物理硬件
硬件
```

