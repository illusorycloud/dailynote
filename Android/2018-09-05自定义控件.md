# 一、自定义控件

## 1.1 组合控件

将一些小的控件组合起来形成一个新的控件 

### 1 布局 title_bar.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<android.support.constraint.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <Button
        android:id="@+id/btn"
        android:layout_width="40dp"
        android:layout_height="20dp"
        android:background="@mipmap/ic_launcher"
        app:layout_constraintTop_toTopOf="parent" />

    <TextView
        android:id="@+id/tv"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginEnd="8dp"
        android:layout_marginStart="8dp"
        android:text="这是标题"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent" />
</android.support.constraint.ConstraintLayout>
```

### 2 创建一个自定义控件类TitleView，继承自RelativeLayout

```java
package com.example.administrator.customviewv2;

import android.content.Context;
import android.util.AttributeSet;
import android.view.LayoutInflater;
import android.widget.Button;
import android.widget.RelativeLayout;
import android.widget.TextView;

public class TitleView extends RelativeLayout {
    private Button btn;
    private TextView tv;

    public TitleView(Context context, AttributeSet attrs) {
        super(context, attrs);
        //加载上边的title_bar布局 root 为this
        LayoutInflater.from(context).inflate(R.layout.title_bar, this);
        btn = findViewById(R.id.btn);
        tv = findViewById(R.id.tv);
    }
//按钮设置监听
    public void setIbtnOnClickListener(OnClickListener listener) {
        btn.setOnClickListener(listener);
    }
    //设置标题的方法
    public void setTv(String title) {
        tv.setText(title);
    }
} 
```

### 3 将自定义控件添加到主布局

```xml
   <com.example.administrator.customviewv2.TitleView
        android:id="@+id/title_bar"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content">

    </com.example.administrator.customviewv2.TitleView>
```

### 4 MainActivity

```java
onCreate方法中获取控件并设置监听
title_bar = super.findViewById(R.id.title_bar);
title_bar.setIbtnOnClickListener(new View.OnClickListener() {
    @Override
    public void onClick(View v) {
        Toast.makeText(MainActivity.this,"点击的返回按钮,修改了标题",Toast.LENGTH_SHORT).show();
        title_bar.setTv("新设置的标题");
        finish();
    }

});
```

## 1.2 自绘控件

自绘控件的内容都是自己绘制出来的，在View的onDraw方法中完成绘制 

### 1 创建CounterView类，继承自View，实现OnClickListener接口

```java
package com.example.administrator.customviewv2;

import android.content.Context;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.graphics.Rect;
import android.support.annotation.Nullable;
import android.util.AttributeSet;
import android.view.View;

public class CounterView extends View implements View.OnClickListener {
    private Paint mPaint;
    private Rect mBounds;
    private int mCount;


    public CounterView(Context context, @Nullable AttributeSet attrs) {
        super(context, attrs);
        mPaint = new Paint(Paint.ANTI_ALIAS_FLAG);//初始化画笔，添加抗锯齿ANTI_ALIAS_FLAG
        mBounds = new Rect();
        setOnClickListener(this);
    }

    @Override
    public void onClick(View view) {
        mCount++;
        invalidate();
    }

    @Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);
//int转string
        String text = String.valueOf(mCount);
        mPaint.setColor(Color.RED);
        canvas.drawRect(0, 0, getWidth(), getHeight(), mPaint);
//        获取数字占的最小位置 一个矩形
        mPaint.getTextBounds(text, 0, text.length(), mBounds);
//        获取数字的宽高
        float textWidth = mBounds.width();
        float textHeight = mBounds.height();
        mPaint.setColor(Color.GREEN);
        mPaint.setTextSize(100);
//        将数字显示在正中间
        canvas.drawText(text, getWidth() / 2 - textWidth / 2, getHeight() / 2 + textHeight / 2, mPaint);
    }
}
```

### 2 添加到主布局中

```xml
<com.example.administrator.customviewv2.CounterView
    android:id="@+id/countview"
    android:layout_width="200dp"
    android:layout_height="200dp" />
```

## 1.3 继承控件

继承已有的控件，创建新控件，保留继承的父控件的特性，并且还可以引入新特性 

...待续